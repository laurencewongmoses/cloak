<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Mosaddek">
    <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <link rel="shortcut icon" href="img/favicon.html">
    <title>首页</title>
    <!--引入公共样式-->
    <#include "/common/linked.html">
</head>

<body>

<section id="container" class="">
    <!--引入公共头-->
    <#include "/common/header.html">
    <!--引入公共侧边栏-->
    <#include "/common/sidebar.html">
    <!--网站主类容-->
    <section id="main-content">
        <section class="wrapper">
            <!-- 页面开始-->
            Page content goes here
            <!-- 页面结束-->
            <div class="row">
                <div class="col-lg-12">
                    <section class="panel">
                        <header class="panel-heading">
                            K线走势
                        </header>
                        <div class="panel-body">
                            <div id="candelstic" class="graph" style="height: 800px"></div>
                        </div>
                    </section>

                    <!--<section class="panel">-->
                        <!--<header class="panel-heading">-->
                            <!--百比图-->
                        <!--</header>-->
                        <!--<div class="panel-body">-->
                            <!--<div id="to100" class="graph" style="height: 800px"></div>-->
                        <!--</div>-->
                    <!--</section>-->
                </div>
                <!--<div class="col-lg-6">-->
                    <!--<section class="panel">-->
                        <!--<header class="panel-heading">-->
                            <!--iPhone CPU benchmarks-->
                        <!--</header>-->
                        <!--<div class="panel-body">-->
                            <!--<div id="hero-bar" class="graph"></div>-->
                        <!--</div>-->
                    <!--</section>-->
                <!--</div>-->
            </div>
        </section>
    </section>
    <!--网站主类容结束-->
</section>
<#include "/common/script.html">
<script type="text/javascript">
    $(".technicalli").addClass("active");
    $(".history").addClass("active");


    var upColor = '#00da3c';
    var downColor = '#ec0000';

    var data = [[
        "2016-04-18",
        17890.2,
        18004.16,
        17848.22,
        18009.53,
        89390000
    ],
        [
            "2016-04-19",
            18012.1,
            18053.6,
            17984.43,
            18103.46,
            89820000
        ],
        [
            "2016-04-20",
            18059.49,
            18096.27,
            18031.21,
            18167.63,
            100210000
        ],
        [
            "2016-04-21",
            18092.84,
            17982.52,
            17963.89,
            18107.29,
            102720000
        ],
        [
            "2016-04-22",
            17985.05,
            18003.75,
            17909.89,
            18026.85,
            134120000
        ],
        [
            "2016-04-25",
            17990.94,
            17977.24,
            17855.55,
            17990.94,
            83770000
        ],
        [
            "2016-04-26",
            17987.38,
            17990.32,
            17934.17,
            18043.77,
            92570000
        ],
        [
            "2016-04-27",
            17996.14,
            18041.55,
            17920.26,
            18084.66,
            109090000
        ],
        [
            "2016-04-28",
            18023.88,
            17830.76,
            17796.55,
            18035.73,
            100920000
        ],
        [
            "2016-04-29",
            17813.09,
            17773.64,
            17651.98,
            17814.83,
            136670000
        ],
        [
            "2016-05-02",
            17783.78,
            17891.16,
            17773.71,
            17912.35,
            80100000
        ],
        [
            "2016-05-03",
            17870.75,
            17750.91,
            17670.88,
            17870.75,
            97060000
        ],
        [
            "2016-05-04",
            17735.02,
            17651.26,
            17609.01,
            17738.06,
            95020000
        ],
        [
            "2016-05-05",
            17664.48,
            17660.71,
            17615.82,
            17736.11,
            81530000
        ],
        [
            "2016-05-06",
            17650.3,
            17740.63,
            17580.38,
            17744.54,
            80020000
        ],
        [
            "2016-05-09",
            17743.85,
            17705.91,
            17668.38,
            17783.16,
            85590000
        ],
        [
            "2016-05-10",
            17726.66,
            17928.35,
            17726.66,
            17934.61,
            75790000
        ],
        [
            "2016-05-11",
            17919.03,
            17711.12,
            17711.05,
            17919.03,
            87390000
        ],
        [
            "2016-05-12",
            17711.12,
            17720.5,
            17625.38,
            17798.19,
            88560000
        ],
        [
            "2016-05-13",
            17711.12,
            17535.32,
            17512.48,
            17734.74,
            86640000
        ],
        [
            "2016-05-16",
            17531.76,
            17710.71,
            17531.76,
            17755.8,
            88440000
        ],
        [
            "2016-05-17",
            17701.46,
            17529.98,
            17469.92,
            17701.46,
            103260000
        ],
        [
            "2016-05-18",
            17501.28,
            17526.62,
            17418.21,
            17636.22,
            79120000
        ],
        [
            "2016-05-19",
            17514.16,
            17435.4,
            17331.07,
            17514.16,
            95530000
        ],
        [
            "2016-05-20",
            17437.32,
            17500.94,
            17437.32,
            17571.75,
            111990000
        ],
        [
            "2016-05-23",
            17507.04,
            17492.93,
            17480.05,
            17550.7,
            87790000
        ],
        [
            "2016-05-24",
            17525.19,
            17706.05,
            17525.19,
            17742.59,
            86480000
        ],
        [
            "2016-05-25",
            17735.09,
            17851.51,
            17735.09,
            17891.71,
            79180000
        ],
        [
            "2016-05-26",
            17859.52,
            17828.29,
            17803.82,
            17888.66,
            68940000
        ],
        [
            "2016-05-27",
            17826.85,
            17873.22,
            17824.73,
            17873.22,
            73190000
        ],
        [
            "2016-05-31",
            17891.5,
            17787.2,
            17724.03,
            17899.24,
            147390000
        ],
        [
            "2016-06-01",
            17754.55,
            17789.67,
            17664.79,
            17809.18,
            78530000
        ],
        [
            "2016-06-02",
            17789.05,
            17838.56,
            17703.55,
            17838.56,
            75560000
        ],
        [
            "2016-06-03",
            17799.8,
            17807.06,
            17689.68,
            17833.17,
            82270000
        ],
        [
            "2016-06-06",
            17825.69,
            17920.33,
            17822.81,
            17949.68,
            71870000
        ],
        [
            "2016-06-07",
            17936.22,
            17938.28,
            17936.22,
            18003.23,
            78750000
        ],
        [
            "2016-06-08",
            17931.91,
            18005.05,
            17931.91,
            18016,
            71260000
        ],
        [
            "2016-06-09",
            17969.98,
            17985.19,
            17915.88,
            18005.22,
            69690000
        ],
        [
            "2016-06-10",
            17938.82,
            17865.34,
            17812.34,
            17938.82,
            90540000
        ],
        [
            "2016-06-13",
            17830.5,
            17732.48,
            17731.35,
            17893.28,
            101690000
        ],
        [
            "2016-06-14",
            17710.77,
            17674.82,
            17595.79,
            17733.92,
            93740000
        ],
        [
            "2016-06-15",
            17703.65,
            17640.17,
            17629.01,
            17762.96,
            94130000
        ],
        [
            "2016-06-16",
            17602.23,
            17733.1,
            17471.29,
            17754.91,
            91950000
        ],
        [
            "2016-06-17",
            17733.44,
            17675.16,
            17602.78,
            17733.44,
            248680000
        ],
        [
            "2016-06-20",
            17736.87,
            17804.87,
            17736.87,
            17946.36,
            99380000
        ],
        [
            "2016-06-21",
            17827.33,
            17829.73,
            17799.8,
            17877.84,
            85130000
        ],
        [
            "2016-06-22",
            17832.67,
            17780.83,
            17770.36,
            17920.16,
            89440000
        ]];


    function splitData(rawData) {
        var categoryData = [];
        var values = [];
        var volumes = [];
        for (var i = 0; i < rawData.length; i++) {
            categoryData.push(rawData[i].splice(0, 1)[0]);
            values.push(rawData[i]);
            volumes.push([i, rawData[i][4], rawData[i][0] > rawData[i][1] ? 1 : -1]);
        }

        return {
            categoryData: categoryData,
            values: values,
            volumes: volumes
        };
    }


    function calculateMA(dayCount, data) {
        var result = [];
        for (var i = 0, len = data.values.length; i < len; i++) {
            if (i < dayCount) {
                result.push('-');
                continue;
            }
            var sum = 0;
            for (var j = 0; j < dayCount; j++) {
                sum += data.values[i - j][1];
            }
            result.push(+(sum / dayCount).toFixed(3));
        }
        return result;
    }

    var dom2 = document.getElementById("candelstic");
    var myChart = echarts.init(dom2,"light");

    function setCandel(rawData) {

        var data = splitData(rawData);

        myChart.setOption(option = {
            backgroundColor: '#fff',
            animation: false,
            legend: {
                bottom: 10,
                left: 'center',
                data: ['Dow-Jones index', 'MA5', 'MA10', 'MA20', 'MA30']
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'cross'
                },
                backgroundColor: 'rgba(245, 245, 245, 0.8)',
                borderWidth: 1,
                borderColor: '#ccc',
                padding: 10,
                textStyle: {
                    color: '#000'
                },
                position: function (pos, params, el, elRect, size) {
                    var obj = {top: 10};
                    obj[['left', 'right'][+(pos[0] < size.viewSize[0] / 2)]] = 30;
                    return obj;
                }
            },
            axisPointer: {
                link: {xAxisIndex: 'all'},
                label: {
                    backgroundColor: '#777'
                }
            },
            toolbox: {
                feature: {
                    dataZoom: {
                        yAxisIndex: false
                    },
                    brush: {
                        type: ['lineX', 'clear']
                    }
                }
            },
            brush: {
                xAxisIndex: 'all',
                brushLink: 'all',
                outOfBrush: {
                    colorAlpha: 0.1
                }
            },
            visualMap: {
                show: false,
                seriesIndex: 5,
                dimension: 2,
                pieces: [{
                    value: 1,
                    color: downColor
                }, {
                    value: -1,
                    color: upColor
                }]
            },
            grid: [
                {
                    left: '10%',
                    right: '8%',
                    height: '50%'
                },
                {
                    left: '10%',
                    right: '8%',
                    top: '63%',
                    height: '16%'
                }
            ],
            xAxis: [
                {
                    type: 'category',
                    data: data.categoryData,
                    scale: true,
                    boundaryGap : false,
                    axisLine: {onZero: false},
                    splitLine: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax',
                    axisPointer: {
                        z: 100
                    }
                },
                {
                    type: 'category',
                    gridIndex: 1,
                    data: data.categoryData,
                    scale: true,
                    boundaryGap : false,
                    axisLine: {onZero: false},
                    axisTick: {show: false},
                    splitLine: {show: false},
                    axisLabel: {show: false},
                    splitNumber: 20,
                    min: 'dataMin',
                    max: 'dataMax'
                }
            ],
            yAxis: [
                {
                    scale: true,
                    splitArea: {
                        show: true
                    }
                },
                {
                    scale: true,
                    gridIndex: 1,
                    splitNumber: 2,
                    axisLabel: {show: false},
                    axisLine: {show: false},
                    axisTick: {show: false},
                    splitLine: {show: false}
                }
            ],
            dataZoom: [
                {
                    type: 'inside',
                    xAxisIndex: [0, 1],
                    start: 40,
                    end: 100
                },
                {
                    show: true,
                    xAxisIndex: [0, 1],
                    type: 'slider',
                    top: '85%',
                    start: 98,
                    end: 100
                }
            ],
            series: [
                {
                    name: 'Dow-Jones index',
                    type: 'candlestick',
                    data: data.values,
                    itemStyle: {
                        normal: {
                            color: upColor,
                            color0: downColor,
                            borderColor: null,
                            borderColor0: null
                        }
                    },
                    tooltip: {
                        formatter: function (param) {
                            param = param[0];
                            return [
                                'Date: ' + param.name + '<hr size=1 style="margin: 3px 0">',
                                'Open: ' + param.data[0] + '<br/>',
                                'Close: ' + param.data[1] + '<br/>',
                                'Lowest: ' + param.data[2] + '<br/>',
                                'Highest: ' + param.data[3] + '<br/>'
                            ].join('');
                        }
                    }
                },
                {
                    name: 'MA5',
                    type: 'line',
                    data: calculateMA(5, data),
                    smooth: true,
                    lineStyle: {
                        normal: {opacity: 0.5}
                    }
                },
                {
                    name: 'MA10',
                    type: 'line',
                    data: calculateMA(10, data),
                    smooth: true,
                    lineStyle: {
                        normal: {opacity: 0.5}
                    }
                },
                {
                    name: 'MA20',
                    type: 'line',
                    data: calculateMA(20, data),
                    smooth: true,
                    lineStyle: {
                        normal: {opacity: 0.5}
                    }
                },
                {
                    name: 'MA30',
                    type: 'line',
                    data: calculateMA(30, data),
                    smooth: true,
                    lineStyle: {
                        normal: {opacity: 0.5}
                    }
                },
                {
                    name: 'Volume',
                    type: 'bar',
                    xAxisIndex: 1,
                    yAxisIndex: 1,
                    data: data.volumes
                }
            ]
        }, true);

        // myChart.on('brushSelected', renderBrushed);

        // function renderBrushed(params) {
        //     var sum = 0;
        //     var min = Infinity;
        //     var max = -Infinity;
        //     var countBySeries = [];
        //     var brushComponent = params.brushComponents[0];
        //
        //     var rawIndices = brushComponent.series[0].rawIndices;
        //     for (var i = 0; i < rawIndices.length; i++) {
        //         var val = data.values[rawIndices[i]][1];
        //         sum += val;
        //         min = Math.min(val, min);
        //         max = Math.max(val, max);
        //     }
        //
        //     panel.innerHTML = [
        //         '<h3>STATISTICS:</h3>',
        //         'SUM of open: ' + (sum / rawIndices.length).toFixed(4) + '<br>',
        //         'MIN of open: ' + min.toFixed(4) + '<br>',
        //         'MAX of open: ' + max.toFixed(4) + '<br>'
        //     ].join(' ');
        // }

        myChart.dispatchAction({
            type: 'brush',
            areas: [
                {
                    brushType: 'lineX',
                    coordRange: ['2016-04-02', '2016-06-20'],
                    xAxisIndex: 0
                }
            ]
        });
    }

    setCandel(data);



</script>
<!--<script type="text/javascript">-->
    <!--var to100 = document.getElementById("to100");-->
    <!--var to100Chart = echarts.init(to100,"light");-->
    <!--option = {-->
        <!--xAxis: {-->
            <!--type: 'category',-->
            <!--data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']-->
        <!--},-->
        <!--yAxis: {-->
            <!--type: 'value'-->
        <!--},-->
        <!--series: [{-->
            <!--data: [820, 932, 901, 934, 1290, 1330, 1320],-->
            <!--type: 'line',-->
            <!--smooth: true-->
        <!--}]-->
    <!--};-->
    <!--to100Chart.setOption(option);-->

    <!--$.ajax({-->
        <!--url : '${request.contextPath}/techApi/to100/002129/volume',-->
        <!--type : "GET",-->
        <!--data : {-->

        <!--},-->
        <!--success:function(data) {-->
            <!--var xdata = new Array();-->
            <!--var seriesV = new Array();-->
            <!--if(data != null){-->
                <!--for(var i = 0;i< data.length ; i++){-->
                    <!--for(key in data[i]){-->
                        <!--xdata[i] = key;-->
                        <!--var n = Number(data[i][key]);-->
                        <!--seriesV[i] = parseFloat(n.toFixed(4));-->
                    <!--}-->
                <!--}-->
            <!--}-->
            <!--console.log(xdata);-->
            <!--console.log(seriesV);-->
            <!--to100Chart.setOption({-->
                <!--xAxis:[{-->
                    <!--type: 'category',-->
                    <!--data: xdata-->
                <!--}],-->
                <!--series:[-->
                    <!--{-->
                        <!--data: seriesV,-->
                        <!--type: 'line',-->
                        <!--smooth: true-->
                    <!--}-->
                <!--]-->
            <!--})-->

        <!--},-->
        <!--error:function(data) {-->
        <!--}-->
    <!--})-->

<!--</script>-->
</body>
</html>
